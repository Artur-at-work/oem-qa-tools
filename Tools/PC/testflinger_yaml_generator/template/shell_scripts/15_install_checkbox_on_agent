# Install the checkbox controller.
# The controller has to come from the ppa:checkbox-dev/beta
# which is equivalent to the beta channel in the snap store
# this way the versions will match
sudo add-apt-repository -y ppa:checkbox-dev/beta
sudo apt update
sudo DEBIAN_FRONTEND=noninteractive apt install -yqq checkbox-ng

echo "Installing checkbox in agent container"
# shellcheck disable=SC2050
if [ "False" == False ]; then
  # if we are testing using debs on the dut
  CHECKBOX_CLI_CMD="checkbox-cli"
else
  # we are testing using snaps on the dut
  CHECKBOX_CLI_CMD="checkbox.checkbox-cli"
fi

CHECKBOX_VERSION=$(_run $CHECKBOX_CLI_CMD --version)
git clone --depth=1 https://github.com/canonical/hwcert-jenkins-tools.git > /dev/null
git clone --filter=tree:0 https://github.com/canonical/checkbox.git > /dev/null
hwcert-jenkins-tools/version-published/checkout_to_version.py ~/checkbox "$CHECKBOX_VERSION"
(cd checkbox/checkbox-ng || return; sudo python3 setup.py install > /dev/null)
